# تقرير البنية المعمارية للنظام الخلفي (Backend Architecture Report) - النسخة التفصيلية والمبسطة

بناءً على طلبك، قمت بتبسيط التقرير وتوسيع الشرح ليكون مفهوماً بشكل كامل، مع إضافة شرح للمصطلحات التقنية، وتوضيح الأدوات الإضافية (مثل Swagger)، وشرح كيف تنتقل البيانات وتعالج داخل النظام.

---

## 1. شرح مبسط للتقنيات والمصطلحات المستخدمة

في عالم البرمجة، نستخدم أدوات تشبه أدوات البناء لتسهيل العمل. إليك شرح لكل أداة ومصطلح في نظامك:

*   **إطار العمل (Framework) - واسمه هنا NestJS:**
    *   **معناه المبسط:** تخيل أنك تريد بناء عمارة. بدلاً من أن تصنع الطوب والأسمنت بنفسك من الصفر، إطار العمل يعطيك أعمدة وجدران وقواعد جاهزة ومختبرة لتبني عليها فوراً.
    *   **لماذا NestJS؟** لأنه منظم جداً ويفرض على المبرمجين ترتيب أكوادهم بطريقة موحدة (مثل تقسيم الغرف في العمارة)، مما يمنع الفوضى ويعتبر ممتازاً للأنظمة الكبيرة (Enterprise-level).
*   **لغة البرمجة (TypeScript):**
    *   **معناها المبسط:** هي نسخة مطورة من لغة JavaScript. ميزتها أنها "صارمة"؛ أي أنها تكتشف الأخطاء الإملائية والمنطقية أثناء الكتابة (قبل أن يشغل المستخدم النظام)، مما يقلل من الأعطال المفاجئة.
*   **نظام التوثيق (Swagger):**
    *   **معناه المبسط:** هو بمثابة "كتالوج" أو "دليل استخدام" حي وجميل.
    *   **دوره:** عندما يبرمج مطور الـ Backend النظام بمئات الروابط (مثل رابط جلب الطلاب، رابط حفظ درجات، الخ)، يأتي المبرمج الآخر (مطور تطبيق الجوال أو الويب) ويسأل: كيف أستخدم هذه الروابط؟ **Swagger** يقرأ الأكواد تلقائياً ويولد صفحة ويب أنيقة تشرح كل رابط، وماذا يحتاج من بيانات، بل ويسمح بتجربتها مباشرة دون كتابة كود إضافي.
*   **وسيط قاعدة البيانات (ORM) - واسمه هنا Prisma:**
    *   **معناه المبسط:** هو "المترجم" بين لغة البرمجة (TypeScript) وقاعدة البيانات (MySQL).
    *   **دوره:** بدلاً من أن يكتب المبرمج أوامر قاعدة بيانات معقدة (SQL Queries) قد تحتوي على أخطاء، يطلب المبرمج من Prisma (مثلاً: `prisma.user.find()`)، وPrisma يتولى التحدث مع قاعدة البيانات بأمان وسرعة فائقة.
*   **المصادقة والأمان (JWT, Passport, Bcrypt):**
    *   **Bcrypt:** أداة تأخذ كلمة المرور (مثلاً: `123456`) وتطحنها وتحولها إلى نص مشفر ومعقد جداً (مثلاً: `$2b$10$xyz...`) قبل حفظها في قاعدة البيانات. حتى لو سُرقت قاعدة البيانات، لن تُعرف كلمات المرور الأصلية.
    *   **JWT (JSON Web Token):** هو بمثابة "بطاقة هوية مؤقتة" تُعطى للمستخدم بعد تسجيل الدخول بنجاح. كلما أراد المستخدم فعل شيء (مثل طلب كشف درجات)، يبرز هذه البطاقة للنظام ليتأكد من هويته وصلاحياته دون الحاجة لكتابة اسم المستخدم لكلمة المرور في كل مرة.
*   **تغليف بيئة العمل (Docker):**
    *   **معناه المبسط:** حاوية صغيرة تجمع فيها كود المشروع وقاعدة البيانات وكل ما تحتاجه للتشغيل.
    *   **فائدتها:** تنهي مشكلة "الكود كان يعمل في جهازي، لكنه لا يعمل في سيرفر المدرسة!". Docker يضمن أن بيئة التشغيل متطابقة في كل مكان.

---

## 2. كيف تسافر البيانات؟ (رحلة الطلب والمعالجة)

لنفترض أن مدير المدرسة فتح النظام للبحث عن تفاصيل طالب معين. كيف يتم هذا خلف الكواليس؟

1.  **الطلب (The Request):** مدير المدرسة يضغط على زر "عرض الطالب" في واجهة المستخدم (React/React Native). الواجهة ترسل طلباً إلكترونياً (مثل إرسال رسالة بريد) إلى خادم الـ Backend عبر رابط معين، مثلاً `GET /students/5`.
2.  **حارس البوابة (Controller):** في نظام NestJS، أول من يستقبل هذه الرسالة هو حارس يسمى الـ `Controller`. مهمة الـ Controller هي:
    *   التحقق: هل الشخص الذي أرسل الطلب لديه "بطاقة هوية" (JWT)؟
    *   الاستقبال: أخذ رقم الطالب (5) من الرسالة والتأكد أنه رقم صحيح.
    *   التوجيه: يمرر الطلب للقسم المختص (الـ Service). لا يقوم المعالج هنا بالتفكير أبعد من ذلك.
3.  **العقل المدبر والمعالجة (Service):** يستلم الـ `Service` الطلب. هنا يتواجد "ذكاء النظام" (Business Logic). الـ Service يسأل: 
    *   هل مسموح لهذا المدير رؤية هذا الطالب؟
    *   إذا كان مسموحاً، الـ Service يتواصل مع المترجم (Prisma).
4.  **المترجم ومستودع البيانات (Prisma & Database):**
    *   يقول الـ Service لـ Prisma: "ابحث لي عن الطالب رقم 5 واجلب لي درجاته".
    *   Prisma يترجم هذا الطلب إلى لغة قاعدة البيانات (MySQL).
    *   تبحث قاعدة البيانات (MySQL) في المجلدات (الجداول) وتعيد النتيجة لـ Prisma، الذي بدوره يعيدها للـ Service ككود مفهوم.
5.  **الرد (The Response):** 
    *   يقوم الـ Service بتنسيق المعلومات (مثلاً إخفاء كلمات مرور الطالب)، ويعيدها إلى الـ Controller.
    *   الـ Controller يغلف النتيجة ويرسلها أخيراً إلى تطبيق الويب/الجوال ليراها المدير على الشاشة بوضوح.

**هذه العملية (Controller -> Service -> Database) تتكرر مع كل عملية في النظام، وهذا يضمن ترتيباً صارماً جداً للعمليات.**

---

## 3. تقييم المعمارية: هل هي قوية، حلوة، وسهلة الصيانة والإنجاز؟

**بكل تأكيد ووضوح: نعم 100%. هذه البنية تُصنّف كبنية احترافية متقدمة (Enterprise Architecture) للأنظمة الكبيرة والموثوقة.**

### أين تكمن الحلاوة والقوة والسهولة هنا؟
1.  **البرمجة الوحدوية (Modular System - تقسيم الغرف):** 
    *   **المعنى المبسط:** كل نظام فرعي (الطلاب، المالية، الدرجات) يعيش في مجلد مستقل تماماً يشبه "الوحدة" أو "الغرفة المغلقة" الخاصة به داخل مجلد `src/modules`.
    *   **الفائدة:** إذا حدث خطأ في قسم "باصات المدرسة"، فإن قسم "لجان الامتحانات" سيستمر بالعمل بدون أن يتأثر! وإذا أردنا إضافة ميزة في النظام المالي، فلن نلمس أكواد شؤون الموظفين. هذا يجعل "الإنجاز والصيانة" سهلين للغاية ودون إحداث خرابات غير مقصودة.
2.  **هيكلة واضحة للتوسع الزمني:**
    عندما ينمو النظام غداً ليصبح ضخماً، التركيبة الحالية لن تنهار بل ستستوعب ذلك بسهولة بفضل فصل المهام الواضح بين الـ Controller (الاستقبال) والـ Service (التفكير) والـ Prisma (التخزين). 
3.  **ميزة الحذف الآمن (Soft Delete):**
    تصميم قواعد البيانات (كما يظهر في ملف `schema.prisma`) لا يحذف أي مستخدم أو قيد مالي بشكل نهائي. بل يضع عليه علامة "محذوف" وفي الخلفية يحتفظ به. هذا ينقذك من أي أخطاء بشرية.
4.  **تتبع شامل لكل همسة (Audit Logs):**
    النظام يرفق وحدة المراقبة `audit-logs`. أي أن النظام سيقوم تلقائياً بتدوين (تم تعديل درجة الطالب س بواسطة المدرس ص في الساعة ع ومن الجهاز الفلاني). هذه ميزة قوية للغاية في إثبات سير العمل.

---

**الخلاصة المبسطة:**
المهندسون الذين يصممون هذا النظام، لم يصمموا "موقع إنترنت" بسيط، بل بنوا لك **"مصنع معلومات"** مفصل ودقيق ومجزأ لضمان الأمان، سهولة وسرعة التوسعة، ولتجنب الكوارث الفنية عند زيادة عدد الطلاب المدارس التي ستستخدمه.
